## 📆 2025-10-27

### 🔔 스크럼

- JWT 강의(+실습코드) 복습 및 정리
- 과제 1번 정리 : 인증/인가 쿠키/세션방식으로 구현
- 과제 2번 어떻게 구현할지 고민 : 인증·인가 JWT 방식으로 구현

### 🚀 Today I Learned

#### HTTP Stateless

- 상태
  - stateful : 상태를 기억 O
    - 나만을 위한 경우s
  - stateless : 상태 기억 X → HTTP의 특징
    - 모두를 위한 빠른처리
- 그럼에도 상태를 저장하고 싶을땐?
  - 쿠키 : 서버가 브라우저에 남기는 정보
    - 서버에 저장할건 아닌데, 유저한테 개인화 하고 싶을때 사용
    - 브라우저에 붙어있으니까 보완 취약 → 보완하기 위해 세션 사용
  - 세션 : 매번 인증하지 않고, 세션저장소에 저장해서 확인
    - 세션 저장소에서는 누가 로그인했나 등 다른 기능을 알 수 알수있음 ex) 디바이스별 동시 로그인관리, 비번변경시 강제 로그아웃
    - 브라우저가 많을수록 동시요청이 많으니 서버에서 받아 세션저장소에 다 저장하는데, 비용 많이듬
  - JWT

#### JWT

- Json Web Token: 인증에 필요한 정보를 담은 토큰
- 애플리케이션 간의 정보 교환을 위해 설계된, 정보를 JSON 형식으로 포함하는 자체 포함형(compact and self-contained) 토큰
- 서버에서 만들어짐!
- 헤더를 통해 전송됨
- 인증과정
  - 브라우저 → 로그인시도(id, pw) → 서버 인증 → 성공시 “인증정보 + 서명” → 브라우저에 전달됨
  - **브라우저는 인증할때마다 JWT 같이 보냄 → 서버는 헤더의 JWT확인, 디코딩하여 인증함**
  - 서버가 관리하는 세션저장소가 없음
- 구조
  - 헤더 + 내용 + 서명
    - 헤더 : typ(토큰의 유형), alg(사용된 서명 알고리즘 정의, HS256)
    - **내용(페이로드)** : 토큰에 담길 정보 즉, 클레임을 포함
      - 클레임? 토큰 사용자에 관한 정보나 추가 메타데이터
      - jwt토큰은 인코딩한거뿐 보안을 유지하고있지 않음(암호화 되어있지 X). 그냥 직렬화한것일뿐
      - **iat, exp와 같은 발행과 만료정보**
    - 서명 : 헤더와 페이로드를 합찬뒤, 헤더에서 정의한 알고리즘으로 해시하고, 비밀키를 사용하여 서명한 결과
      - why? 서명은 토큰이 변조되지 않았음을 검증하는 데 사용
- 인코딩과 디코딩
  - 그냥 인코딩과 디코딩으로 누구나 알 수 있지만, 서명정보도 같이 보내서 누가 서명해서 보낸건지 알수는 있음
  - 서명은 서버가 인증하는거라, 클라이언트에서 서명을 바꾸거나 하느건 의미없음
- 왜 사용?
  - 사용자의 인증 상태를 유지하면서 서버간의 부담을 줄이고, stateless 인증을 가능하게 하기 위함
  - 안정적인 확장성 : 헤더를 통해 전송되며, 추가적인 저장소나 상태관리 없이도 쉽게 확장 가능함 & 각 요청이 독립적 처리되므로 서버 인스턴스가 여러 대일 경우 에도 원활하게 동작함
  - 초기에는 jwt로 구현 → 이후에는 세션스토어 추가 도입
- 결국 클라이언트가 들고 있는 JWT토큰!
  - 보안에 민감한 정보 저장 불가능
  - 토큰 탈취시 유효 기간 내, 대응 불가능
- 해결방법
  - 탈취시
    - 서버입장에서 토큰만 보면 알 수 없음.
    - httpOnly로 방지 : 자바스크립트로 탈취하는 것을 방지 → 무조건은 아니지만 탈취가 어려워짐. 기본적인 방법
    - **짧은 유효 기간 설정**
      - Access Token : 짧은 유효기간, 인증용 jwt 전달 (5분~15분, 30분)
      - Refresh Token : 긴 유효기간, 재발급용 jwt전달 (7일, 30일)
      - 서버에서 위 토큰을 브라우저한테 전달해주면됨
      - 위 토큰을 브라우저가 들고있느냐, 서버가 들고있느냐는 구현방식과 보안정도에 따라 다름
      - Access Token으로만 구현할수 있지만, 귀찮아질 뿐
      - 로그아웃할때는 access token은 클라이언트에서 지우고, refresh token도 지워야함
    - 블랙리스트 체크
      - 짧은유효기간이라 하더라도 그 기간만큼은 무적인것임
      - 해당 jwt가 로그아웃되거나 하면 블랙리스트에 넣어서 서버가 인증확인할때 블랙리스트를 한번 확인해서 거르면됨
- 세션 인증 vs 토큰인증
  - 유저의 인증정보를 서버가 관리할까(세션인증)? 클라이언트가 관리할까(토큰인증)
- JWT 변조 가능성
  - Q : 엑세스 토큰 안에 유효기간, 해커가 유효기간을 수정해서 계속 사용할 수 있지않나?
  - A : 불가능. JWT는 내용을 볼수는 있지만 값을 바꿀수 없음 → 서명이 깨짐
    - 볼수있다? base64로 인/디코딩하면 볼 수 있다는 의미
    - jwt 서버 서명키는 노출하면 안됨! → 깃헙에도 올리지 말라
    - 서명키는 예측이 된다! → 주기적으로 바꾸든가 등 주기적으로 관리해줘야함
  - Q : access token탈취하면 refersh token도 탈취된거 아닌가?
  - A : 보통 요청을 보낼때 탈취가 되는데, 요청을 보낼때는 access token만 보내지 refresh token은 보내지 X
    - secure : https 통신일때만 쿠키보내
    - httpOnly : 자바스크립트에서 쿠키 못건듬

### 🗨️ 오늘의 회고

- JWT 실습코드를 따라했을때는 한줄한줄 이해안가는 곳이 많았는데, 복습을 하고 디버깅하면서 어떻게 동작하는지를 이해할 수 있었다. 복습의 중요성을 또한번 깨달았다.
